---
title: 'useLayoutEffect'
subTitle: 'useLayoutEffect ê³µë¶€í•´ë³´ê¸° (ìŠ¤í„°ë”” ë°œí‘œ ìë£Œ)'
date: '2023-10-27'
tag: 'React'
url: 'react-3'
thumbnail: './imgs/3/1.png'
thumbnail_alt: 'useLayoutEffect ê³µì‹ ë¬¸ì„œ ìº¡ì³ í™”ë©´'
---

<br />

> ğŸ’¡ `useLayoutEffect`ëŠ” performanceì— ì˜í–¥ì„ ì¤„ ìˆ˜ ìˆë‹¤. ê°€ëŠ¥í•˜ë©´ `useEffect`ë¥¼ ì‚¬ìš©í•˜ë¼.

### useLayoutEffectë€

í™”ë©´ì„ ë Œë”ë§ í•˜ê¸° ì „ì— ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ” `useEffect`.

### ì‚¬ìš©ë²•

#### ìƒê¹€ìƒˆ

```jsx
useLayoutEffect(setup, dependencies?)
```

`useEffect`ì™€ ë™ì¼í•˜ë‹¤.

#### ì£¼ì˜ì‚¬í•­

useLayoutEffect ë‚´ì˜ ì½”ë“œ ë° ì´ë¡œ ì¸í•´ ì˜ˆì•½ëœ ëª¨ë“  ìƒíƒœ ì—…ë°ì´íŠ¸ëŠ”
ë¸Œë¼ìš°ì €ê°€ í™”ë©´ì„ ë‹¤ì‹œ ê·¸ë¦¬ëŠ” ê²ƒì„ ì°¨ë‹¨í•œë‹¤.

ì´ë¥¼ ì§€ë‚˜ì¹˜ê²Œ ì‚¬ìš©í•˜ë©´ ì•±ì´ ëŠë ¤ì§ˆ ìˆ˜ ìˆë‹¤.

ë”°ë¼ì„œ ê°€ëŠ¥í•˜ë©´ useEffectë¥¼ ì‚¬ìš©í•´ì•¼ í•œë‹¤.

### ì˜ˆì‹œ

ë²„íŠ¼ì— hoverì‹œ tooltipì´ ëœ¨ë„ë¡ êµ¬í˜„ëœ ì½”ë“œ.

```jsx
import { useRef, useLayoutEffect, useState } from 'react';
import { createPortal } from 'react-dom';
import TooltipContainer from './TooltipContainer.js';

export default function Tooltip({ children, targetRect }) {
  const ref = useRef(null);
  const [tooltipHeight, setTooltipHeight] = useState(0);

  useLayoutEffect(() => {
    const { height } = ref.current.getBoundingClientRect();
    setTooltipHeight(height);
  }, []);

  let tooltipX = 0;
  let tooltipY = 0;
  if (targetRect !== null) {
    tooltipX = targetRect.left;
    tooltipY = targetRect.top - tooltipHeight;
    if (tooltipY < 0) {
      // It doesn't fit above, so place below.
      tooltipY = targetRect.bottom;
    }
  }

  return createPortal(
    <TooltipContainer x={tooltipX} y={tooltipY} contentRef={ref}>
      {children}
    </TooltipContainer>,
    document.body,
  );
}
```

ReactëŠ” useLayoutEffect ë‚´ë¶€ì˜ ì½”ë“œ ë° ê·¸ ì•ˆì—ì„œ ì˜ˆì•½ëœ ëª¨ë“  ìƒíƒœ ì—…ë°ì´íŠ¸ê°€ ë¸Œë¼ìš°ì €ê°€ í™”ë©´ì„ ë‹¤ì‹œ repaint í•˜ê¸° ì „ì— ì²˜ë¦¬ë  ê²ƒì„ ë³´ì¥í•œë‹¤.
ì´ëŠ” ê³§ tooltipì„ ì²˜ìŒ ë Œë”ë§í•˜ê³  ì¬í‰ê°€í•˜ê³ , ë‹¤ì‹œ ì¬ë Œë”ë§í•˜ê²Œ ë˜ëŠ” ê³¼ì •ì—ì„œ ì‚¬ìš©ìëŠ” ì´ë¥¼ ì¸ì§€í•˜ì§€ ëª»í•˜ê²Œ ëœë‹¤.
ë‹¤ì‹œ ë§í•´, useLayoutEffectì€ browserê°€ paintingí•˜ëŠ” ê²ƒì„ ë§‰ëŠ”ë‹¤.

ì•„ë˜ëŠ” ê°™ì€ ì½”ë“œë¥¼ useEffectë¥¼ ì´ìš©í•˜ì—¬ êµ¬í˜„í•œ ê²ƒì´ë‹¤.
ë Œë”ë§ ì†ë„ë¥¼ ëŠ¦ì¶”ê¸° ìœ„í•´ ì•½ê°„ì˜ ì½”ë“œê°€ ì¶”ê°€ë˜ì–´ ìˆë‹¤.

```jsx
import { useRef, useEffect, useState } from 'react';
import { createPortal } from 'react-dom';
import TooltipContainer from './TooltipContainer.js';

export default function Tooltip({ children, targetRect }) {
  const ref = useRef(null);
  const [tooltipHeight, setTooltipHeight] = useState(0);

  // ë Œë”ë§ ì†ë„ ì¼ë¶€ë¡œ ë‚®ì¶”ê¸°
  let now = performance.now();
  while (performance.now() - now < 100) {
    // ì•„ë¬´ê²ƒë„ í•˜ì§€ ì•ŠëŠ”ë‹¤,,,
  }

  useEffect(() => {
    const { height } = ref.current.getBoundingClientRect();
    setTooltipHeight(height);
  }, []);

  let tooltipX = 0;
  let tooltipY = 0;
  if (targetRect !== null) {
    tooltipX = targetRect.left;
    tooltipY = targetRect.top - tooltipHeight;
    if (tooltipY < 0) {
      tooltipY = targetRect.bottom;
    }
  }

  return createPortal(
    <TooltipContainer x={tooltipX} y={tooltipY} contentRef={ref}>
      {children}
    </TooltipContainer>,
    document.body,
  );
}
```

useEffectëŠ” ë¹„ë™ê¸°ë¡œ ì²˜ë¦¬ê°€ ë˜ë©°, Effectê°€ paint ì „ì— ì‹¤í–‰ëœë‹¤ê³  ë³´ì¥í•˜ì§€ ì•ŠëŠ”ë‹¤. ë”°ë¼ì„œ tooltipì˜ ì´ˆê¸° ìœ„ì¹˜(0)ê°€ ì ì‹œ í‘œì‹œë  ìˆ˜ ìˆê³  ì´ë¡œ ì¸í•œ ê¹œë¹¡ê±°ë¦¼ì´ ë°œìƒí•  ìˆ˜ ìˆë‹¤.
