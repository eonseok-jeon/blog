---
title: 'SWRì„ ì´ìš©í•œ ë°ì´í„° refetching'
subTitle: 'SWR ê³µë¶€í•˜ê¸°'
date: '2024-03-13'
tag: 'React'
thumbnail: './imgs/7/1.png'
thumbnail_alt: 'useContext ê³µì‹ ë¬¸ì„œ ìº¡ì³ í™”ë©´'
---

# ì‹œì‘

## ë¬¸ì œ ë°œìƒ

![ë¬¸ì œ í™”ë©´](./imgs/7/1.png)

`dashboard` ëª©í‘œ ë¦¬ìŠ¤íŠ¸ì—ì„œ ìš°í´ë¦­ìœ¼ë¡œ ëª©í‘œ ì‚­ì œ ì‹œ ë°”ë¡œ ë°˜ì˜ë˜ì§€ ì•Šê³  ìƒˆë¡œê³ ì¹¨ì´ë‚˜ re-focus ì‹œì— ë°˜ì˜ì´ ë˜ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí•˜ì˜€ë‹¤.
dataê°€ re-fetching ë˜ì§€ ì•ŠëŠ” ê²ƒì¸ì§€ ì˜ ëª¨ë¥´ê² ì§€ë§Œ ì–´ì¨Œë“  SWRê³¼ ê´€ë ¨ì´ ìˆë‹¤ê³  íŒë‹¨ì´ ë˜ì—ˆë‹¤.

## í˜„ì¬ ì½”ë“œ

```tsx
// Index.tsx
const url = currentGoalId
  ? `/v1/objective?objectiveId=${currentGoalId}`
  : '/v1/objective';

const { data: treeData, isLoading } = useSWR(url, getDashBoardData);

const goalListTreeData = treeData?.data.objList;

// fetcher.ts
export const getDashBoardData = async (url: string) => {
  const response = await instance.get(url);
  return response.data;
};
```

ìœ„ì™€ ê°™ì´ ìš”ì²­ì„ ë³´ë‚¸ ë’¤ `objList`ë¥¼ `goalListTreeData`ì— ì €ì¥ì‹œí‚¨ í›„ ì´ë¥¼ ë Œë”ë§ í•˜ê³ ,

```tsx
const { mutate } = useSWRConfig();

//ìš°í´ë¦­ì˜ ì‚­ì œ ë²„íŠ¼ í´ë¦­ ì‹œì˜ í•¸ë“¤ëŸ¬
const handleClickDelObjBtn = () => {
  setTargetModal(MAINDASHBOARD_MODAL_CASE.OBJ.DEL);
};

//ëª©í‘œ ì‚­ì œ ëª¨ë‹¬ -> ì‚­ì œ ë²„íŠ¼ í´ë¦­ ì‹œì˜ í•¸ë“¤ëŸ¬
const handleComfirmDelObj = async () => {
  setTargetModal(null);
  try {
    await deleteObj(`/v1/objective/${rightClickState.rightClickId}`);
    await mutate('/v1/objective');
  } catch {
    navigate('/error');
  }
};
```

ëª¨ë‹¬ì„ í†µí•´ ì‚­ì œí•˜ê¸° ë²„íŠ¼ì„ í´ë¦­í•˜ê²Œ ë˜ë©´ delete APIë¥¼ ë³´ë‚´ê³ , mutateë¥¼ í†µí•´ re-fetching í•˜ëŠ” ë°©ì‹ì´ë‹¤.

# ì›ì¸

ì›ì¸ì€ global mutateë¥¼ ì‚¬ìš©í•´ì„œ ê·¸ë¬ì—ˆë‹¤.

[global mutateì— ëŒ€í•œ ì„¤ëª…](https://swr.vercel.app/ko/docs/mutation#global-mutate)ì„ ë³´ë©´ ì•„ë˜ì™€ ê°™ì´ ë‚˜ì™€ìˆë‹¤.

> ğŸ’¡ `key`Â ë§¤ê°œë³€ìˆ˜ë§Œ ìˆëŠ” global mutatorë¥¼ ì‚¬ìš©í•˜ë©´ ë™ì¼í•œ í‚¤ë¥¼ ì‚¬ìš©í•˜ëŠ” ë§ˆìš´íŠ¸ëœ SWR hookì´ ì—†ëŠ” í•œÂ **ìºì‹œë¥¼ ì—…ë°ì´íŠ¸í•˜ê±°ë‚˜ ì¬ê²€ì¦ì„ íŠ¸ë¦¬ê±°í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.**

ë§ˆìš°ìŠ¤ ìš°í´ë¦­ì„ í•˜ëŠ” ìˆœê°„ `currentGoalId`ì— Idê°’ì´ ì§€ì •ëœë‹¤.
ê·¸ë ‡ê²Œ ë˜ë©´ urlì´ `/v1/objective?objectiveId=${currentGoalId}` ë¡œ ë³€í•˜ê²Œ ëœë‹¤.
í•˜ì§€ë§Œ ìš°ë¦¬ê°€ mutate í•˜ëŠ” ê²ƒì€ `/v1/objective`ë¡œ ìœ„ì™€ ë‹¤ë¥¸ url ê°’ì´ë‹¤.

ë‹¤ì‹œ ë§í•´ mutate ë  ë•Œ, `/v1/objective`ì™€ ë™ì¼í•œ í‚¤(url)ì„ ì‚¬ìš©í•˜ëŠ” SWR hookì´ ì—†ê²Œ ë˜ì–´ ì¬ê²€ì¦ì„ í•˜ì§€ ì•Šê²Œ ë˜ëŠ” ê²ƒì´ë‹¤.

ì˜ˆì‹œë¥¼ ë“¤ì–´ë³´ì.
ë§Œì•½ ì•„ë˜ì™€ ê°™ì´ 2ê°œì˜ hookì´ mount ë˜ì–´ìˆë‹¤ê³  í•œë‹¤ë©´,

```tsx
const { data: data1 } = useSWR('/v1/objective');
const { data: data2 } = useSWR('/v1/objective?objectiveId=${currentGoalId}');
```

`mutate('/v1/objective')`Â ì˜ í˜¸ì¶œì€ ì²« ë²ˆì§¸ hookë§Œ revalidate í•  ê²ƒì´ë‹¤.

[Global mutate doesn't work Â· vercel swr Â· Discussion #746](https://github.com/vercel/swr/discussions/746#discussioncomment-123351)

# í•´ê²°

## ì²« ë²ˆì§¸ ë°©ë²•

ìš°ë¦¬ê°€ mutateí•˜ëŠ” urlì€ `/v1/objective` ì´ë‹¤.
í•˜ì§€ë§Œ ëª©í‘œ ì‚­ì œë¥¼ ëˆ„ë¥´ë©´ í•´ë‹¹ objIdë¥¼ paramsë¡œ ë„˜ê²¨ì£¼ì–´ì•¼ í•˜ê¸° ë•Œë¬¸ì— objId ê°’ì´ ì„¤ì •ë˜ì–´ ìˆì–´, `/v1/objective?objectiveId=${currentGoalId}` ê°€ ì‹¤í–‰ì´ ëœë‹¤.

`/v1/objective`ê°€ ì‹¤í–‰ë˜ë„ë¡ í•˜ë ¤ë©´ ì–´ë–»ê²Œ í•˜ë©´ ë ê¹Œ?

ë‹µì€ ê°„ë‹¨í•˜ë‹¤.
objIdì˜ ê°’ì„ ì´ˆê¸°í™” ì‹œì¼œì£¼ë©´ ëœë‹¤.

```tsx
const [currentGoalId, setCurrentGoalId] = useState<number>();
// ...
const handleComfirmDelObj = async () => {
  setTargetModal(null);
  setCurrentGoalId(undefined); // ë°”ë¡œ ì´ ë¶€ë¶„ ì¶”ê°€!!!!
  try {
    await deleteObj(`/v1/objective/${rightClickState.rightClickId}`);
    mutate('/v1/objective');
  } catch {
    navigate('/error');
  }
};
```

ì´ë ‡ê²Œ í•œë‹¤ë©´ mutate í•  ë•Œ, `currentGoalId`ê°€ ì •ì˜ ë˜ì–´ ìˆì§€ ì•Šì•„, `/v1/objective`ì˜ url key ê°’ì´ ë§ˆìš´íŠ¸ ë˜ê²Œ ëœë‹¤.

## ë‘ ë²ˆì§¸ ë°©ë²•

global mutateê°€ ì•„ë‹Œ `bound mutate`ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ë‹¤.
ì‚¬ì‹¤ ì´ ë°©ë²•ì´ ë” ì‰¬ìš´ ê±° ê°™ë‹¤.

```tsx
const { data: treeData, isLoading, mutate } = useSWR(url, getDashBoardData);
```

ë°©ë²•ì€ ê°„ë‹¨í•˜ë‹¤. ìœ„ì™€ ê°™ì´ mutateë¥¼ ì¶”ê°€í•´ì£¼ë©´ ëœë‹¤.
ì´ë ‡ê²Œ í–ˆì„ ë•Œ ì¥ì ì€ key ê°’ì„ ë”°ë¡œ ì „ë‹¬í•´ì£¼ì§€ ì•Šì•„ë„ ë˜ê²Œ ëœë‹¤.

```tsx
const handleComfirmDelObj = async () => {
  setTargetModal(null);
  try {
    await deleteObj(`/v1/objective/${rightClickState.rightClickId}`);
    mutate(); // ì´ ë¶€ë¶„ ì¶”ê°€!!!
  } catch {
    navigate('/error');
  }
};
```

ë³€ê²½ë˜ëŠ” dataëŠ” ì—†ìœ¼ë‹ˆ ì¸ìê°’ ì—†ì´ `mutate`ë¥¼ ì‹¤í–‰ì‹œí‚¤ë©´ ëœë‹¤.
ì°¸ê³ ë¡œ ê³µì‹ë¬¸ì„œì—ì„œëŠ” `mutate` ì•ì— `await`ë¥¼ ë¶™ì´ì§€ ì•Šì€ ê²ƒìœ¼ë¡œ ë³´ì•„ `await`ë¥¼ ì œê±° í•´ë„ ë¬´ë°©í•  ê±° ê°™ë‹¤.

ë‹¤ë¥¸ ê±° ê±´ë“¤ì¼ í•„ìš” ì—†ì´ ì €ë ‡ê²Œë§Œ ì„¤ì •í•´ì£¼ë©´ ìë™ìœ¼ë¡œ revalidate í•´ì¤€ë‹¤.

# key ê°’ì´ ì—¬ëŸ¬ ê°œì¸ ê²½ìš°

## ì‹œì‘

ë°ì´í„° ì •ë ¬í•˜ëŠ” ë¡œì§ì„ ìœ„í•´,
year, category, criteria
ì´ 3ê°œì˜ request body dataê°€ í•„ìš”í•˜ë‹¤.

ë˜í•œ ì´ ê°’ë“¤ ì¤‘ í•˜ë‚˜ë¼ë„ ë°”ë€” ë•Œë§ˆë‹¤ data re-fetchingì´ ë°œìƒí•´ì•¼ í•œë‹¤.

## ì²˜ìŒ ì½”ë“œ

```tsx
const [selectedFilter, setSelectedFilter] =
  useState<filterOptionTypes>('ìµœì‹ ìˆœ');
const [selectedTheme, setSelectedTheme] = useState(null);
const [selectedYear, setSelectedYear] = useState(null);
const isSelectedYear = selectedYear ? Number(selectedYear.slice(0, 4)) : null;

const { data, isLoading } = useSWR('/api/user', (url) =>
  getOKRHistory(url, isSelectedYear, selectedTheme, selectedFilter),
);
```

ì²˜ìŒì—ëŠ” ìœ„ì™€ ê°™ì´ ë°ì´í„°ë¥¼ ë„˜ê²¨ì£¼ì—ˆë‹¤.

í•˜ì§€ë§Œ ê°’ì´ ë³€ê²½ë˜ì–´ë„ ìœ„ì—ì„œ ë°œìƒí–ˆë˜ ê²ƒê³¼ ê°™ì´ ë°”ë¡œë°”ë¡œ ì—…ë°ì´íŠ¸ê°€ ë˜ì§€ ì•ŠëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆë‹¤.

## í•´ê²° ê³¼ì •

### refreshInterval

ìë™ìœ¼ë¡œ intervalë¡œ refresh í•´ì£¼ëŠ” ê²ƒì´ ìˆë‹¤ê³  í•´ì„œ ë°”ë¡œ ì ìš©í•´ ë³´ì•˜ë‹¤.

```tsx
const { data, isLoading } = useSWR(url, getDashBoardData, {
  refreshInterval: 100,
});
```

ìœ„ì™€ ê°™ì´ ì„¤ì •ì„ í•´ì£¼ë‹ˆ ê°’ì´ ë³€ê²½ëœ í›„ 0.1ì´ˆ í›„ì— ë°”ë¡œ ì—…ë°ì´íŠ¸ê°€ ë˜ì—ˆë‹¤.

ê·¸ëŸ°ë° ì´ëŸ° ì‹ìœ¼ë¡œ í•˜ë©´ ë§¤ 0.1ì´ˆë§ˆë‹¤ ì—…ë°ì´íŠ¸ë¥¼ í•´ì£¼ëŠ” ê²ƒì¸ë° ì´ëŠ” ë¶„ëª…íˆ ë¶ˆí•„ìš”í•˜ë©° ì´ë³´ë‹¤ ë” ì¢‹ì€ ë°©ë²•ì´ ìˆì„ ê²ƒì´ë€ ìƒê°ì´ ê°•í•˜ê²Œ ë“¤ì—ˆë‹¤.

### ë‹¤ë¥¸ ë” ì¢‹ì€ ë°©ë²•

[ì¸ì â€“ SWR](https://swr.vercel.app/ko/docs/arguments#multiple-arguments)

ì• ì´ˆì— ì˜ëª» ì‚¬ìš© í•˜ê³  ìˆì—ˆë‹¤.

ê³µì‹ë¬¸ì„œì— ë³´ë©´

> ğŸ’¡ ì´ëŠ”Â **ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤**. ì™œëƒí•˜ë©´ ë°ì´í„°ì˜ ì‹ë³„ì(ë˜í•œ ìºì‹œ í‚¤)ê°€Â `'/api/user'`ì´ê³ , ë§Œì•½Â `token`ì´ ë³€ê²½ë˜ì–´ë„ SWRì€ ì—¬ì „íˆ ë™ì¼í•œ í‚¤ë¥¼ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— ì˜ëª»ëœ ë°ì´í„°ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.

ë¼ê³  ì´ë ‡ê²Œ ì‚¬ìš©í•˜ë©´ ì•ˆ ëœë‹¤ê³  ë‚˜ì™€ìˆì—ˆë‹¤.

ëŒ€ì‹  ì•„ë˜ì™€ ê°™ì´ keyê°’ì„ ë°°ì—´ë¡œ ë„˜ê²¨ì£¼ì–´ì•¼ í•œë‹¤ê³  í•œë‹¤.

```tsx
const { data, isLoading } = useSWR(
  ['/v1/objective/history', isSelectedYear, selectedTheme, selectedFilter],
  ([url, isSelectedYear, selectedTheme, selectedFilter]) =>
    getOKRHistory(url, isSelectedYear, selectedTheme, selectedFilter),
);
```

ì´ë ‡ê²Œ ìˆ˜ì •ì„ í•˜ë‹ˆ, 3ê°œì˜ ê°’ ì¤‘ í•˜ë‚˜ë¼ë„ ë‹¬ë¼ì§€ë©´ key ê°’ì´ ë³€ê²½ëœ ê²ƒìœ¼ë¡œ ê°„ì£¼ë˜ì–´ re-fetchingì´ ì§„í–‰ë˜ì—ˆë‹¤.

ë—!
